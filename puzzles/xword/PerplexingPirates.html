<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<!--
MIT License
Copyright (c) 2019 Viresh Ratnakar
See the full Exolve license notice in exolve-m.js.
-->
<link rel="stylesheet" type="text/css" href="exolve/exolve-m.css"/>
<script src="exolve/exolve-m.js"></script>

<title>Perplexing Pirates by Darren Miller</title>

<style>
	body {
		font-family: "Gill Sans", sans-serif;
	}

	@media print {
		.extractButton {
		     visibility: hidden;
	   }
	}

	/* The Modal (background) */
	.modal {
	  display: none; /* Hidden by default */
	  position: fixed; /* Stay in place */
	  z-index: 5; /* Sit on top */
	  padding-top: 100px; /* Location of the box */
	  left: 0;
	  top: 0;
	  width: 100%; /* Full width */
	  height: 100%; /* Full height */
	  overflow: auto; /* Enable scroll if needed */
	  background-color: rgb(0,0,0); /* Fallback color */
	  background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
	}
	/* Modal Content */
	.modal-content {
	  position: relative;
	  background-color: #fefefe;
	  margin: auto;
	  padding: 0;
	  border: 1px solid #888;
	  width: 80%;
	  box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2),0 6px 20px 0 rgba(0,0,0,0.19);
	  -webkit-animation-name: animatetop;
	  -webkit-animation-duration: 0.4s;
	  animation-name: animatetop;
	  animation-duration: 0.4s
	}

	/* Add Animation */
	@-webkit-keyframes animatetop {
	  from {top:-300px; opacity:0} 
	  to {top:0; opacity:1}
	}

	@keyframes animatetop {
	  from {top:-300px; opacity:0}
	  to {top:0; opacity:1}
	}

	/* The Close Button */
	.modal-close {
	  color: white;
	  float: right;
	  font-size: 28px;
	  font-weight: bold;
	}

	.modal-close:hover,
	.modal-close:focus {
	  color: #000;
	  text-decoration: none;
	  cursor: pointer;
	}

	.modal-header {
	  padding: 2px 16px;
	  background-color: navy;
	  color: white;
	}

	.modal-body {
		padding: 16px;
		text-align: center;
		font-family: Consolas, monospace;
		font-size: larger;
		letter-spacing: -3px;
	}

	.modal-footer {
	  padding: 2px 16px;
	  background-color: #5cb85c;
	  color: white;
	}
</style>
</head>
<body>

<script src="exolve/dkm-exolve-utils.js"></script>
<div id="extractModal" class="modal">

  <!-- Modal content -->
  <div class="modal-content">
    <div class="modal-header">
      <span class="modal-close">&times;</span>
      <h3>Extraction</h3>
    </div>
    <div class="modal-body" onclick="selectall(this);">
    </div>
  </div>

</div>
<script>

let markedCells = [
	'o10', 'g13', 'f8', 'i9', 'a1', 'h14', 
	'j7', 'a3', 'n8', 'j8', 'k11', 'e14', 
	'l5', 'g6', 'j5', 'c5', 'o5', 'n14', 
	'g4', 'e3', 'i15', 'e12', 'm8', 'k12',
	'k10', 'e2', 'n6', 'j1', 'l13', 'f10',
	'f4', 'f12', 'h2', 'm12', 'c9', 'd13',
	'a11', 'a13', 'm3', 'i3', 'm7', 'd2',
	'f3', 'n3', 'd3', 'o7', 'n4', 'a4',
	'o1', 'g15', 'i11', 'b15', 'g9', 'j3',
	'c8', 'e7', 'h1', 'c7', 'j15', 'm15', 
	'e15', 'k13', 'e10'
];

function markupCells(p, cells, ht, basewid, labelcolor='') {
	for(let i=0; i<cells.length; i++) {
		let coords = p.parseCellLocation(cells[i]);   // [row,col]
		let wid = (i+1).toString().length*basewid-1;
		let c = p.addCellText(coords[0], coords[1], (i+1), ht, wid, false, true);
		c.style['stroke-width'] = 0.7;
		if(labelcolor) {
			c.style.stroke = labelcolor;	
		}
	}
	
	p.cellActivator(0,0); 
}

let extractModal;

function doCloseModal() {
	if(extractModal) { 
		if(extractModal.style.display == "none") { return; }
		extractModal.style.display = "none";
		window.getSelection().removeAllRanges();
	}
}

function getMarkedCells(pid) {

	let p = exolvePuzzles[pid];
	let result = '';
	for(let i=0; i<markedCells.length; i++) {
		if (result) { result += ' '; }
		let coords = p.parseCellLocation(markedCells[i]);   // [row,col]
		let gridCell = p.grid[coords[0]][coords[1]];
		if (gridCell.currLetter == '0' || gridCell.currLetter == '?') {
			result += "_";
		} else {
			result += gridCell.currLetter;
		}
	}
	// Get the modal
	if (!extractModal) {
		extractModal = document.getElementById("extractModal");
	
		if(extractModal) {
			var span = document.getElementsByClassName("modal-close");
			span[0].onclick = doCloseModal;
			window.onclick = function(e) {
				if(e.target == extractModal) { doCloseModal(); }
			}
			document.addEventListener('keydown', (event) => {
  			if (event.key === 'Escape') { doCloseModal(); }
  		});
		}
	}

	if(extractModal) {
		var modalBody = document.getElementsByClassName("modal-body");
		if(modalBody) {
			modalBody[0].innerHTML = result;
			extractModal.style.display = "block";
		}
	}
}

function selectall(elem) {
	if (window.getSelection) {
    var range = document.createRange();
    range.selectNode(elem);
    window.getSelection().removeAllRanges();
    window.getSelection().addRange(range);
  }
}

function customizeExolve(p) {
	markupCells(p, markedCells, 10, 6, 'darkblue');

  const b = document.createElement('button');
  b.className = 'xlv-button';
  b.innerHTML = 'Extract cells';
  b.title = 'Extract cells'
  b.addEventListener('click', (evt) => {
    getMarkedCells(p.id);
  });
  p.buttonRow1.appendChild(b);	
}


function decryptStringWithXOR(input,key) {
  var c = '';
  var lastvalue = 0;
  
	var databuf = window.atob(input);   
  
   for(var i=0; i<databuf.length; i++) {
   		var k = i % key.length
      var value1 = databuf.charCodeAt(i);
      var value2 = key.charCodeAt(k);

      var xorValue = value1 ^ value2 ^ lastvalue
			lastvalue = value1;
			
      c += String.fromCharCode(xorValue);
  }
  return c;
}

const exolvedata = `
	JAsNMX95OGNXWVMMVDd8cVxnc1RwCgo+PH93JRldThY2FAsGIFkTcgFkB3dv
	aX0rFgkPEzUfAAQ0WgIDJwIbJ3phZDMFTH8nByU6NxFPF2ZCbWtXGR9eFCA9
	Kn5eJ2xAdFJYbEM0ECl9cnswayJhNR8zNCoaY3hGd1lCeyQvNzRFHk1OLk1i
	a0xqd0gpMzMPW11DcAFITgc6FQgFfUpAdFFvclFTECh0VktNDi9WHTIVJDtK
	TzR9bDotKX9AUBNqMlEaFzoBFTIWbHJLFwAEB3YueEMxUlxMdk5AdBgnKxJN
	Rl5dLHQiGWsIBhYsFBouQmV+SxIcEkdzIElxKj4weExreExpHgQ7bmgkbVVO
	TAk+DkVMORwRJRc0NAtdEl4FITx/OgAmJD5LfmhKfE5Vdm56czgMRVQEIgkH
	HWhfVX1Mb29cSgkocFhTVURvQ10VIxYAcVhqb09IC21dBVBGG3cIDw5lfmha
	fgkZJmsoN2FcQ0VUcllXHzobGTIfLWgYVF9WTyIqaTAQNjtuHGs0RWtSWGQ1
	NTI2QFtdGD8OC0NxQExQcFVXYj4eF0J/ZS49CyMlYEV4ckJ3RV8iKHslLl0d
	WVZqXFpQYEZbbg8rMxZPXlcdcDY0O0l9f3tCNikRJhRdbHRxdCMTFlUWLQoF
	ATFLD3FcYjVvXjRkMQleZDodfnZ/RDA7HzwGBiI6ICNvTAUAWGRGQQk9Bwwq
	DitiXRdUXwMmb2Q8ADcvZ1NzK3A4ZjMCGhEPU2QwdC0LPCc8Uyh/SmpPVGE3
	Jzt3XE9AFDVYUVVvXFd2WHs8D1hWFQt6GXNLbUdYXGwFWkxiFQg3LwgFTm1h
	bHtIe39kCi11dEBtfkIfD0MYJSMnMUN0fmRWZ2sHYWliXgcKDRN8UVMQMBYT
	XWlNWngCJm9vIjsteExWFUZ4VFgMdkMFegd/ekNFLEl5FFJEGXU8dz8PIzQJ
	PgxIdz8oLXtEF1QGOxQQCnJHXHlRcHwWQkhDEjcnIXxCbnIQZREMJQswLxoP
	Ax9Samxhahg4PDgCJHFJZkFdeXtqaSkZHB1AZ0EKATsDFDdbbXZUAxdBFCwi
	KWxHYWZiWHsJeBkrOgVRRE1ZZ35pMQwhcDgONSEfLFZTajU+JjIPBwZSbAIA
	BiMCDmVTbGxIFXwwKR0MAF15XxkeOxsKNBt2PwxbVFccYGVvOQM0cm5ecn4C
	KhMKL2M6IXBIVVNoGnl3Z11la18zCxI2Z2tpahsRHUB9TAoAIAAMMh1wd0YI
	El4EOj8zcA8uMCwNNiBcdU1SZy10aCQHHhFFHX41OBUuOh05Q0VlKSMgdxxV
	VQgvCRFUcURSZksxNA1bXUJBInsSA3FXREN6WEU5FzAtFENOGAE4OD9rFDQw
	KAR9dUhoXFBoPzA4ZEcDAkZgV1NVcy11BCAPCTV7fTx3Q0ZEFyAPXjxJPWUU
	Ng0BMHojbxUoJCZlFyAjIgRwf0FyQSJSSglFDjolI3NNNH9EeUJNPBUrLAgQ
	FRZdLCgua1F9cjIUaRtqCzkoF0NWX0t9Zmw5URh6G351PUw9NWwcFCh0bQw6
	aSRGeSJqDwRMPUxEHTE5ehwsdC0REGIRJX0IbEsqSyw5WR1OAgt6Ix8ebB8r
	cwZiOmEpdy5eVhVJUDF4KzFTbDcjRjJ6C3oNVC8nZDghQAlaSxNZO2NKLnYX
	dhFYOF8MQElkPSIjUSIWTkQgJEV4Hwpqcht+Ti9mNVs5WgFJLARMYRA7Ym1l
	Jno/XksYdhR3LBt+CnggaA8aej5tfXRZAENCTzx3L1o+GXhFImsLbD9zegtS
	blUORB9XMkYOfw55IAwEOGR9HFUGaAppMnofFFxSI1QNAjBaPzY4YSIjLl1p
	MUQgeBlzFAFheSoZEGE4e3oIezBoHUMyahsTSjoycS1LKmMwIUNfBEwpXRVv
	HmkwQEgLV04vZg83bB9UDAZiOltFIjdXTxxQWVcOTUw+TVoCK09LKkAnbjQF
	bzMqSwJRQCIdRgVgayNSIwhRfXVqNlAxeCs6WDtgKHcqWzoHYHUVUQJOR0kQ
	U1J8DxhANVEJaHYRWDggc2NqG3gSKkgrcDhdVh4zQkoTY2sodDFQRRZbOSV+
	NlNYEGEQGHsiE0AMBXQtERBiESV9CGxoCTRTZQUdTn10BVxgYRNgVDZqN39S
	I1QNfXU2anMSB1QZexhDC24aUiNSJXwMBEcbAnM6eWgaeTJ6D3sjUjNEDX1l
	JmpzAksIGWsIQwt+IFFlXGRhRxpUWQMgJjZ0HFU3VjJGHgAlFlMjeW9vOgIO
	Hg8qAB8falxFcBEgJQBLCAVOejM1fFprZWBQaGkYMQcePn88eHkBYggwVTZ9
	VnFERm4PEBY0f3k1ZUcODB0MLisiEy43CGlcQH01PThvHl8JEUkDYThcKHBg
	ASYuEEFBDVVmYHYzQXZ4cQQzJBs8HgQxbS42Z1MaFUFyVVtBNEgHfzRqCmtg
	I28eLisuPwInbGVCc2VVMkYXdXwofzVEQUcANxhTUnQAHToeJ25TBBUcBTAw
	IHZRYX5/RHcvViBePWRVB19GNxdUFiUfWBA8Bwp3FjIyEFsUWAAjL2w8Ci0v
	JAUiegN3CWozAlAKE2JKCVphVh0aKV1JeVZlLBVeHRBdLDE6bhw3OTAXN29R
	dgE8A1dRWQ9+P2hwKGIAWTtPFwAoGQQ8JCsib0pGVxVnV1NOdUUdLw80MEBQ
	B0JxKUkbE2ECOj0FNGxec01BfzM1NWkYBwFeeFJXWC0bBjEfOjZGEBwfSDl4
	LTVtJ0Ufeg5WQW9UUW4hJzlzAgQBEAMuITsLKHBAZV9ffSBjfyoaCgxPPRYY
	UG1YRDUWJCgWDkUdDVY2XF88XxQxDTUkASEEFGQwNjtmUklZSGldX1lrVkB2
	FzM7CVRFWk8+ICJgRmxpZhMiNAAzAxNjezBpeSJCKCtKKWJJc1VIOR08NApV
	U1MDITwsPQwgJitefmlfe1hZbCZlIStTMFpiAnc8dHJWQWRWISEVREhQGmt1
	fzoALDIuW2prX20aWz8uRyIScSBjcmECHh4uHwt2FzQ1AEECHUVtKGszEnFp
	blZna1J6Q009cXp3OktPTQV3VlgQMgkDPF0ifQQ2XDkzUhtYPgUoY3tCd3YY
	eW1lRQ5NThEmb2o0FHd9NQY7LRl4SUl3JjYyK1IORH8kbjZsGW1BeFxyOxhN
	S0seb0tHBTICTwRpD0YgWi0wD0cEClZkYmw0CCxnbhstPBl4QUdvPjIrYRBR
	Bx9HDW80UiZ+aEBhYV8AQ0sbODQ0cUpmYysKMWlVe0EIPGVoZzcIBkUWJQIF
	FGEdVDVdAGA5MmUpMDY6OHsJMzcqDXljV2VGDyh4fnxlXVpNGTkIFg4vEgQy
	U1RcaCIkbnQdRhQSe0sAGzsfFyMQZyZDVwZDcChIGB9tDjcwAXVsU3YBIVEb
	HQFZYXp8KVt5MjISKzINYVpaYTx/YTcEAhUEfgpIKnYrZwZnEDsCTllQG2ph
	dzIDKCY8SWlwU3VHWnlha2k+Tw5cXSZvDWwNazNCU3dnVAQOARgoIyl0T3hq
	IhY2bl4/BAQ2fH5gIE4HK3QGNzk3Dj8kASkRFmpyZWE5HFMTGnoIVAchVUw9
	ES81EUhASVEgYTcvdz1fA2URSVV1SUU1bGJrPAkTUAAmRUtCZV1cLQ08IRRe
	U1AGOXA7P0QNbw5vD1cmKA8DPSUxNGldFANdLwkDH2pSQ3YXMzUIVV5dE2Ij
	dm42fB5CIFQMHywSHigwIDxkRkIBUXcUDQA5DAw0GytiXgkJBElxd3o4SiF+
	P2A9TChZLmdiND4mek8GBlZ0XkFIcVYOMBdgZloGRWc7HVRyLRg3PTsKfi5M
	JHkZQE0cUElBR1FAdVNMBDgCDjBRdWxTH1xHFzIzcCBSYn1nV2J3Bm8NTRcm
	TBUYaSAAQ3RWSUhrWgIhBSI5DEdBQw4+Iyl3S3swNwRweEh7WFhtJmVlPQ8N
	B1htDhUUJFAAZQ1QMGlkMX1kZn9zKR59ZGVXa2cWNQcIN317N29QXk8HdWVv
	ckN+Jl8oVjVsXQtQSTgUGVxrWkVMcEpXdBUqIgEZGRpOcm5jOwYrYGpNfGVQ
	MU4TalgyV1syezhaaUdcWGgcCzxda2xIGRwCXmp5f25daiEnHWlyS2tOQHVt
	Jn5uNVU/O1AzeFxsWUU0Gj92ThcGDhc0MjJoFnVzelZgfQxlB0cdLEYcFWQt
	GkR7FF9eeUJUJQspNEQIAwoTMTsqfklkL28NcAJaEnMrW0NjYDQIFBlBcFJN
	THZMFCweaWERTUdYACI/OXoIKi8jVmN3S2VBXCx7bXVsUl0eS3hPQQl0F0Yd
	VQtUNi5tSFFsYGUgUnd1fEdwbRw0DQc4bX5+IgcLRldSeWs8SVRYL00ieRgX
	T1BJe31zMgwmLicGNytaM1ERS3oQSkAxeEgRLBgWDHlCXC0INiwbVkZeDjE/
	fD8MO3BoWGBsTi9QAXhKICloVlNGEm1KTlFqBHYuZgNKOlZUVRwoMzlmUzAs
	LQwwaHxceXwKEUoUHHooOCkeMz0nFThsHQ44KEdfFE1dBmYMDnwfJD4OKSIG
	NQcdbSYxOHZGXVoOLx8RCn9fSDkdICwfUxArc0ZKCRB6EHEQTCx0BRQiOR1c
	HxtNb3Jic0dlfX1Bemxcf0RIOGVqbyIWXxQTaCFDIkI2bmxEfmdbGllcCz0x
	PGRZb3c/DSw1FjMXQTFHS1NKaG4tNFM5WDllB18uLllHZTg1f2UMVwUDaloR
	FCQDCHlfZ2tIUFtSGS1kLyhTGngZew9XUHRRQTFhZ2o/GhsBEDUfGhUsHRY0
	VXV0RREXCB9uL3hgOHIQQDVBfFt/Rg8oeH58ZUdLRgNxUFpRbxdPVzBEFXd+
	Kn0gUVZQFyARWkZ2UV0sDHt6RQ8fFg92KmBbAEoYUCUiKhQ6Aw8tNSUoeE0I
	S1xiRV9CeBc8CCxXHhxMSlIfcTgLT2kKBBoqDA0oAT84DxcWG0F7MiV7CSQg
	OgI3I1M0ERw9cHwrMksXXWY9dy11AHReYEhzc00SUVoRITFyMAclbn9DcmZT
	e0JMPGUmOWxUXlZHPUgKaDRpIEMiVX9AFgEIXH14ej8EKC02Q3ZsUmZFDDVq
	Z2QvFxAUBTQbGRwoCBV7GgQZaT85I39cFRNMekoBQSdeEmohfx9+cjF9CDYw
	IHQKaW9iRGNiEzASFWU0OXUvHwYMSXpVHhkqXmJWeUNLaTp5PTJKKUN7GG4l
	bWtTQmMCNCobWhkCU2dgI3NSfXN+Wy82E3JWWmtzOGJyKUkjI0kqYVpmXkpi
	AxseJ2ljbndVTEoVM1AfQjcMGmtZb3NAHV4aFm4NZ18/TgVNS3JrSH1PVCRv
	Y3o3DgITTD4bHxghVUJ9HCcrGkYIAkl9cTJzSG53P0IhcCtjPWYCGll4IB0R
	UgI+GVJUbk4WKgo5fAxWQFhBY2ZgPwkvNn4DYzJpIX8kQVkaJXlcRgVSaVhW
	Hj8EXGgEIS0cQEZYEmMidm42fB5EJlIKFjgcAXEoPDZ6Rw4qfl5wenwJLjcT
	IRcZLDh7ZTkYHg9KfVpdTDlFCHA7ZQVnZiVpFigzM2cVJSYhAHRjR3IFAzUt
	JyZvGFIJCmkdTVYjHwgtCTJ7Aw5EIhJKEEJTISokPgl9bV1vGBBgNjwzbx4U
	H09zV1kRKxlBY1dpdAQUQgc0bAxcWCpJZWIXITgKIFdKdW1rfzIRHRNHNSMy
	OAg3JgQxBwBwODokaUEIQ0Y9dBZ3EXMrWkl7c1EbGRtFcTg6KwspJWEULTQL
	axxdOitCJxd1K2h5bF1DTX5PRGEAPjkPWElIEC8ycSgbKiMkAyR8Xm9RXX5m
	LXlpMlI4OlAzeEJyQE1vSzw9Ak4NEUdiKzFvWmx1aQN3W2JCYS5dXQxRXzUv
	bDMOOXJ1RHQtXDVRFHdmD2paOGgrOjsMEh4yRk10Wn9iEl5cXABxeXgmATZ9
	YVFgbFU0SxRtXzVQXT10N1FrURoeLhsVIUBjZVEIElhCK3AiJE19NikTNSZX
	YloTIndkYDADAwFefwNICGgVZz93FE4+JgcZRXVoYz4JOSFpX2RyR29MTHMl
	ZmsmV1ZUCHwcTxVxElFzEjU5G0VJVwMzNDRgEnkkZTpnFnMHcDk6a2ZjKQwA
	EQA7C0BHZ0cTYlNrcVIDAgJCMy0nYlg7IyQcLSEYMAkHdy4pIX1IAQtUJk0Q
	UQ5TIkcwRw4ZTg0VQzIsJntNLjU8Gzs6S2NaEzdnYS15QUxLFiFCRkg9OiEf
	KhEZJ3s4fHMLaAI6XCdsJDQYECQXNH1CHF9WGSEsKnVEYilpCXQGXhZ1JVVN
	Yns6HgUPUXZGDQM3AQszEXkwL2FneSMdGQpeYlJYRHhCXSwMe35HCxwcQC5n
	LChTGngZeRxENTkBGz8nNj9wSERQBCQUX19rSVQlEyU4DUcEAk54YiE4XzVU
	NWkIQzJTVFhvNiY/dQQOAl5pWRIYLBsIeU9xbFRMX0EXNjorOgAiJysSLzkP
	bhFNNAZsCQVhKGseKRkGHCYLFjUHcGpPBRQXW2RpKndAZGpsXWhiSisfHzt6
	OX1wCGsBVX9TVEp6Ax4hBFk=
`;

let params = new URLSearchParams(document.location.search);
let query = params.get('key');

if(query) {
	let key = query instanceof Array ? query[0] : query;
	exdata = decryptStringWithXOR(exolvedata, key);
	
	if(exdata.match(/[^\s\x20-\x7E]/)) {
		// bad characters or key didn't match
	} else if(exdata.match(/exolve/)) {
		createExolve(exdata);		
	} 
}


</script>
</body>
</html>
