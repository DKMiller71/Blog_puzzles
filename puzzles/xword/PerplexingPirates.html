<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<!--
MIT License
Copyright (c) 2019 Viresh Ratnakar
See the full Exolve license notice in exolve-m.js.
-->
<link rel="stylesheet" type="text/css" href="exolve/exolve-m.css"/>
<script src="exolve/exolve-m.js"></script>

<title>Pirate_C by Darren Miller</title>

<style>
	body {
		font-family: "Gill Sans", sans-serif;
	}

	@media print {
		.extractButton {
		     visibility: hidden;
	   }
	}

	/* The Modal (background) */
	.modal {
	  display: none; /* Hidden by default */
	  position: fixed; /* Stay in place */
	  z-index: 5; /* Sit on top */
	  padding-top: 100px; /* Location of the box */
	  left: 0;
	  top: 0;
	  width: 100%; /* Full width */
	  height: 100%; /* Full height */
	  overflow: auto; /* Enable scroll if needed */
	  background-color: rgb(0,0,0); /* Fallback color */
	  background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
	}
	/* Modal Content */
	.modal-content {
	  position: relative;
	  background-color: #fefefe;
	  margin: auto;
	  padding: 0;
	  border: 1px solid #888;
	  width: 80%;
	  box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2),0 6px 20px 0 rgba(0,0,0,0.19);
	  -webkit-animation-name: animatetop;
	  -webkit-animation-duration: 0.4s;
	  animation-name: animatetop;
	  animation-duration: 0.4s
	}

	/* Add Animation */
	@-webkit-keyframes animatetop {
	  from {top:-300px; opacity:0} 
	  to {top:0; opacity:1}
	}

	@keyframes animatetop {
	  from {top:-300px; opacity:0}
	  to {top:0; opacity:1}
	}

	/* The Close Button */
	.modal-close {
	  color: white;
	  float: right;
	  font-size: 28px;
	  font-weight: bold;
	}

	.modal-close:hover,
	.modal-close:focus {
	  color: #000;
	  text-decoration: none;
	  cursor: pointer;
	}

	.modal-header {
	  padding: 2px 16px;
	  background-color: navy;
	  color: white;
	}

	.modal-body {
		padding: 16px;
		text-align: center;
		font-family: Consolas, monospace;
		font-size: larger;
		letter-spacing: -3px;
	}

	.modal-footer {
	  padding: 2px 16px;
	  background-color: #5cb85c;
	  color: white;
	}
</style>
</head>
<body>

<script src="exolve/dkm-exolve-utils.js"></script>
<div id="extractModal" class="modal">

  <!-- Modal content -->
  <div class="modal-content">
    <div class="modal-header">
      <span class="modal-close">&times;</span>
      <h3>Extraction</h3>
    </div>
    <div class="modal-body" onclick="selectall(this);">
    </div>
  </div>

</div>
<script>

let markedCells = [
	'o10', 'g13', 'f8', 'i9', 'a1', 'h14', 
	'j7', 'a3', 'n8', 'j8', 'k11', 'e14', 
	'l5', 'g6', 'j5', 'c5', 'o5', 'n14', 
	'g4', 'e3', 'i15', 'e12', 'm8', 'k12',
	'k10', 'e2', 'n6', 'j1', 'l13', 'f10',
	'f4', 'f12', 'h2', 'm12', 'c9', 'd13',
	'a11', 'a13', 'm3', 'i3', 'm7', 'd2',
	'f3', 'n3', 'd3', 'o7', 'n4', 'a4',
	'o1', 'g15', 'i11', 'b15', 'g9', 'j3',
	'c8', 'e7', 'h1', 'c7', 'j15', 'm15', 
	'e15', 'k13', 'e10'
];

function markupCells(p, cells, ht, basewid, labelcolor='') {
	for(let i=0; i<cells.length; i++) {
		let coords = p.parseCellLocation(cells[i]);   // [row,col]
		let wid = (i+1).toString().length*basewid-1;
		let c = p.addCellText(coords[0], coords[1], (i+1), ht, wid, false, true);
		c.style['stroke-width'] = 0.7;
		if(labelcolor) {
			c.style.stroke = labelcolor;	
		}
	}
	
	p.cellActivator(0,0); 
}

let extractModal;

function doCloseModal() {
	if(extractModal) { 
		if(extractModal.style.display == "none") { return; }
		extractModal.style.display = "none";
		window.getSelection().removeAllRanges();
	}
}

function getMarkedCells(pid) {

	let p = exolvePuzzles[pid];
	let result = '';
	for(let i=0; i<markedCells.length; i++) {
		if (result) { result += ' '; }
		let coords = p.parseCellLocation(markedCells[i]);   // [row,col]
		let gridCell = p.grid[coords[0]][coords[1]];
		if (gridCell.currLetter == '0' || gridCell.currLetter == '?') {
			result += "_";
		} else {
			result += gridCell.currLetter;
		}
	}
	// Get the modal
	if (!extractModal) {
		extractModal = document.getElementById("extractModal");
	
		if(extractModal) {
			var span = document.getElementsByClassName("modal-close");
			span[0].onclick = doCloseModal;
			window.onclick = function(e) {
				if(e.target == extractModal) { doCloseModal(); }
			}
			document.addEventListener('keydown', (event) => {
  			if (event.key === 'Escape') { doCloseModal(); }
  		});
		}
	}

	if(extractModal) {
		var modalBody = document.getElementsByClassName("modal-body");
		if(modalBody) {
			modalBody[0].innerHTML = result;
			extractModal.style.display = "block";
		}
	}
}

function selectall(elem) {
	if (window.getSelection) {
    var range = document.createRange();
    range.selectNode(elem);
    window.getSelection().removeAllRanges();
    window.getSelection().addRange(range);
  }
}

function customizeExolve(p) {
	markupCells(p, markedCells, 10, 6, 'darkblue');

  const b = document.createElement('button');
  b.className = 'xlv-button';
  b.innerHTML = 'Extract cells';
  b.title = 'Extract cells'
  b.addEventListener('click', (evt) => {
    getMarkedCells(p.id);
  });
  p.buttonRow1.appendChild(b);	
}


function decryptStringWithXOR(input,key) {
  var c = '';
  var lastvalue = 0;
  
	var databuf = window.atob(input);   
  
   for(var i=0; i<databuf.length; i++) {
   		var k = i % key.length
      var value1 = databuf.charCodeAt(i);
      var value2 = key.charCodeAt(k);

      var xorValue = value1 ^ value2 ^ lastvalue
			lastvalue = value1;
			
      c += String.fromCharCode(xorValue);
  }
  return c;
}

const exolvedata = `
	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
	Clc3bmIyfmd7c3svXX95dE9/dAUlBk96IzIycgMLDkt8TUhPdU8XbhpkB15v
	OGB5CC49aVU2KisaK3NWeA8DMn49PW1YEQFfYEZFQmAURCNLFnYvI3c7IjEq
	IHRAIzsjFzAlVHRXHjxhbmMiGh0ZCDYaEhs6BxAvHWorT143UmIGXxwNCicl
	OQk5YVNzVFRwKSY5IB4RUgwyFV54SGszJwg4PQxaXREAYiJLcyheB086NyAE
	ZVVZfWVvbSAeV0cGOwxHWGREVCUFcmhMBgANWShpPyd/NVcKax9HVWZUXHgp
	PDUsDwMQU2RUWlx9SER8UmtxAVZTH1ZmfWoyBTV+ek55alJ9TQQkdXM/LksL
	YloBdypiFxAYJgw+d1UEAARJODM1Yl9uYCgcJjkaIlVvXhMUEQhxLmRfBE4Q
	TzpOc0x5S1B0LScleVoTGEhpCgIFPQQJNh4mIVELGhNLfjd8eQJLKUgoRBxt
	f0lNbTk/cyUSW1kGIAoHHS0cHipLfWAQRkoGXGVtfCodfj1hHUMyah5wOUk9
	OzZrGhwNHCYEHRFkQlVnTTZ/QhsBD1MiYzUtdT9dA2YSSk9hWx5uPy4tegsN
	G14sGxgVYEdcf1tpbh4OWh8sdBRBQTNQeH9HfnNMZFBYfC0hIzoCGFsLeV5c
	R3NUWGxfKCAeQgEMWWVjczZEaHZqHyQ6S25YRXBoI3hoM1M5Pl49dlciGgcw
	BXJ9RB0QH0MyMj9tUH5lYVFxbBNycnNaXR47dgFLEBNwBFRPOg0aJhcsLB9G
	UVgFdDVjeyNpC1UzRx8dNAwSJ20uLXIDDgRGc0VdQX1HWCkaLDFBCQ8PQmAp
	YmsQWTs2GyA0EzdNQH8wPWtYAGAxIFJFT0pvXlRsQ3M6HUxbX0ZSWksWYgJR
	C28MT20MPjkMRkJXQjMICkIvTA9SLnABWStcFRVfWUYMKDM1dwU1KicFMDoP
	Kw8VIGsoMGYXGxJGd0ALNAAwLVw1WhpAcRtDWisSEFN1TwQEPhkVN1Znb0wc
	FhVCcnl2IlB2cXBRYDhBNkgrckMVWUBCQkwNMwlCQ3hLVmlBeWVGXlpDGzg1
	JStZVFBMOR4JeBFzM2lYMmhxAChrLQ0rLmAWejBQJkpQIHVzbCZXWVUBIENA
	TWpbA3oNcxBJeCxgeX5yYytZcnx1TGx8VDUVFSt0e3I4GlNHHi0CDBdsGEgt
	RRh4ISFiLlJ1eXRlQGtlYxYxLBMmUVprMDh4YXk2dn8fbTFiUycxBTIAG2sn
	IT5zAgpJEC0cBAl8AE01fiBAKTFyTQQ6PDFlRSY+Nws7bx55Qk9uIy94EiYq
	ZXR0X1FNbAdfXmpJADV7fWMjBgcNUmcEDQQyDVVwXikuEVtVWA19MiN2VWNn
	NEE9cAhDHX0cFFcbcE5OQRklAUpFYldWJxUnL18eFB1IfX1wJlR2PSYfIjkD
	Yh1COwljBg5tJGcVKAUaFy8LHy8aJCIcVxQZQnxgd2ZdeXx7XGF3QSAUESh9
	f2c7VRw2cwEsIjwMKnJGaVpAMCBwMTxEJ011FmEqYntAV3VRKmNeAxMMTD02
	IH8NJyJqXGlhWWxaXy94fTFMeH9xIQEpYiJBPE4WXjhkFAw8PGxNBAZAc0kC
	HSARB3ZWcndCHwxAGD10ZDADYCN9AV8udgZpIFA7MTFkTAUpdE96eHEEIysf
	MBNaLiNgYzRFX10ZKA5FBWUYajJ6H0Q0LBwdRWZ7fT5MfHhlRHhlRmkeES55
	djpsUxoVQXJVEx06CxZnVmhkRl4VTl4FZQ8MaglCZ1NrdgcnHhNjNTkhOAQM
	CxZkRVtHMhUBNRopJQcfVAwcRydNTilKAToKKiFQd0lSZ39oa3JGAhNHdFNd
	R2EVRSNLFnYvJXE9JDg+LmsZOycpCTFpf1t+eksdXkEZPSclc0QrYHpKbnla
	b11QbC1uKiZePVdvD3U+dmVeVGZCNS8XQFcbTWl0N2ldPjw5HG41XC9JF3w3
	dHAmAw8AEWsdXz1hPHcXdgEgFV9eEkNzaSp6CCUnLBxoc0pqU11ocHx2b01R
	Wx5sB1kYRxprCX0KQ1QDQE4WJCZlIB1+cGBBZ3pGYhUpA1lfWAgqNzVqGCsh
	Oxo3bxZjHX4nFkYcBXRPSRk5CAIENgdfbw4rIxQAQ0IaJW0uN1I4WThkA0w9
	XExXciwpIGpPBgxTZ0tSV2NZVSQNOyASRVRLUnBpYzcWdTZmGkQ1bR9wOUkj
	JS9jQU0OV2pdFg40FExkSnpmRAhUGHVMRFNENU4XTixDSDkWLjNDFBMbA3Iz
	Y34fdRR1KU4Pfh8bBiN/ZSljWlxNCHpNR0NzBx4tAyE8TAAGD0J7Mnl+BUwu
	Ty5LE2J0S1srf3l0Ow9GUQ85GwlHMV0XdwFtdwdIRFoIeWRoeUpkf39DdWRU
	e18JeWk/ekkRcSYkVjUcBjYDDzYbKTMQCAgLXGlpfiYbNn10VSExAS1cFn50
	Jn1/XRQHU3NWUkhwRVNhRTJzFQRtCDhdAUJTUnh9fFp6Z0QlGwFxJjAoPUxV
	WRs6EBkdMUVKckd4MRJFS0IPNjY7bR89Mj4OPmZecQZHITBZPAxpNnVkcV0W
	CjBES3NebSQEXUxUFGVlaHlfdHoyCjcrHjMBSHcpalUPMSwjc09oI2MAfQ9X
	H3wtXUVjdz4KEQYXKg9ESWpXS39QZGgYCF4bKHAQR089XnlkSWhiWnRWTDxi
	YG4lHRdLWkdyfGZQa35fe0JYaSUvLXMCCkkULxgHAzNYAHkNcxBJeC5zahs/
	M3FXNC0gAz4jBSEEHm4+PCZ6CxUXUmVUHx09DgV0HX8/ZVQ+Z20cVWYyByU9
	IAZyaVd7SVMjeXt0JldJQwY8X0ReZEBdfh8gKBZKRUAXIWgjJ1wVdxZ2F08+
	OwkTN31xZDgbAUIAJxYPCCgSDn9SYG5bDQoHTGQtLXVTaSJiA34MVHBfWWUr
	LWwwDwJr
`;

let params = new URLSearchParams(document.location.search);
let query = params.get('key');

if(query) {
	let key = query instanceof Array ? query[0] : query;
	exdata = decryptStringWithXOR(exolvedata, key);
	
	if(exdata.match(/[^\s\x20-\x7E]/)) {
		// bad characters or key didn't match
	} else if(exdata.match(/exolve/)) {
		createExolve(exdata);		
	} 
}


</script>
</body>
</html>
