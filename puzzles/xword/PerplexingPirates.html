<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<!--
MIT License
Copyright (c) 2019 Viresh Ratnakar
See the full Exolve license notice in exolve-m.js.
-->
<link rel="stylesheet" type="text/css" href="exolve/exolve-m.css"/>
<script src="exolve/exolve-m.js"></script>

<title>Perplexing Pirates by Darren Miller</title>

<style>
	body {
		font-family: "Gill Sans", sans-serif;
	}

	@media print {
		.extractButton {
		     visibility: hidden;
	   }
	}

	/* The Modal (background) */
	.modal {
	  display: none; /* Hidden by default */
	  position: fixed; /* Stay in place */
	  z-index: 5; /* Sit on top */
	  padding-top: 100px; /* Location of the box */
	  left: 0;
	  top: 0;
	  width: 100%; /* Full width */
	  height: 100%; /* Full height */
	  overflow: auto; /* Enable scroll if needed */
	  background-color: rgb(0,0,0); /* Fallback color */
	  background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
	}
	/* Modal Content */
	.modal-content {
	  position: relative;
	  background-color: #fefefe;
	  margin: auto;
	  padding: 0;
	  border: 1px solid #888;
	  width: 80%;
	  box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2),0 6px 20px 0 rgba(0,0,0,0.19);
	  -webkit-animation-name: animatetop;
	  -webkit-animation-duration: 0.4s;
	  animation-name: animatetop;
	  animation-duration: 0.4s
	}

	/* Add Animation */
	@-webkit-keyframes animatetop {
	  from {top:-300px; opacity:0} 
	  to {top:0; opacity:1}
	}

	@keyframes animatetop {
	  from {top:-300px; opacity:0}
	  to {top:0; opacity:1}
	}

	/* The Close Button */
	.modal-close {
	  color: white;
	  float: right;
	  font-size: 28px;
	  font-weight: bold;
	}

	.modal-close:hover,
	.modal-close:focus {
	  color: #000;
	  text-decoration: none;
	  cursor: pointer;
	}

	.modal-header {
	  padding: 2px 16px;
	  background-color: navy;
	  color: white;
	}

	.modal-body {
		padding: 16px;
		text-align: center;
		font-family: Consolas, monospace;
		font-size: larger;
		letter-spacing: -3px;
	}

	.modal-footer {
	  padding: 2px 16px;
	  background-color: #5cb85c;
	  color: white;
	}
</style>
</head>
<body>

<script src="exolve/dkm-exolve-utils.js"></script>
<div id="extractModal" class="modal">

  <!-- Modal content -->
  <div class="modal-content">
    <div class="modal-header">
      <span class="modal-close">&times;</span>
      <h3>Extraction</h3>
    </div>
    <div class="modal-body" onclick="selectall(this);">
    </div>
  </div>

</div>
<script>

let markedCells = [
	'o10', 'g13', 'f8', 'i9', 'a1', 'h14', 
	'j7', 'a3', 'n8', 'j8', 'k11', 'e14', 
	'l5', 'g6', 'j5', 'c5', 'o5', 'n14', 
	'g4', 'e3', 'i15', 'e12', 'm8', 'k12',
	'k10', 'e2', 'n6', 'j1', 'l13', 'f10',
	'f4', 'f12', 'h2', 'm12', 'c9', 'd13',
	'a11', 'a13', 'm3', 'i3', 'm7', 'd2',
	'f3', 'n3', 'd3', 'o7', 'n4', 'a4',
	'o1', 'g15', 'i11', 'b15', 'g9', 'j3',
	'c8', 'e7', 'h1', 'c7', 'j15', 'm15', 
	'e15', 'k13', 'e10'
];

function markupCells(p, cells, ht, basewid, labelcolor='') {
	for(let i=0; i<cells.length; i++) {
		let coords = p.parseCellLocation(cells[i]);   // [row,col]
		let wid = (i+1).toString().length*basewid-1;
		let c = p.addCellText(coords[0], coords[1], (i+1), ht, wid, false, true);
		c.style['stroke-width'] = 0.7;
		if(labelcolor) {
			c.style.stroke = labelcolor;	
		}
	}
	
	p.cellActivator(0,0); 
}

let extractModal;

function doCloseModal() {
	if(extractModal) { 
		if(extractModal.style.display == "none") { return; }
		extractModal.style.display = "none";
		window.getSelection().removeAllRanges();
	}
}

function getMarkedCells(pid) {

	let p = exolvePuzzles[pid];
	let result = '';
	for(let i=0; i<markedCells.length; i++) {
		if (result) { result += ' '; }
		let coords = p.parseCellLocation(markedCells[i]);   // [row,col]
		let gridCell = p.grid[coords[0]][coords[1]];
		if (gridCell.currLetter == '0' || gridCell.currLetter == '?') {
			result += "_";
		} else {
			result += gridCell.currLetter;
		}
	}
	// Get the modal
	if (!extractModal) {
		extractModal = document.getElementById("extractModal");
	
		if(extractModal) {
			var span = document.getElementsByClassName("modal-close");
			span[0].onclick = doCloseModal;
			window.onclick = function(e) {
				if(e.target == extractModal) { doCloseModal(); }
			}
			document.addEventListener('keydown', (event) => {
  			if (event.key === 'Escape') { doCloseModal(); }
  		});
		}
	}

	if(extractModal) {
		var modalBody = document.getElementsByClassName("modal-body");
		if(modalBody) {
			modalBody[0].innerHTML = result;
			extractModal.style.display = "block";
		}
	}
}

function selectall(elem) {
	if (window.getSelection) {
    var range = document.createRange();
    range.selectNode(elem);
    window.getSelection().removeAllRanges();
    window.getSelection().addRange(range);
  }
}

function customizeExolve(p) {
	markupCells(p, markedCells, 10, 6, 'darkblue');

  const b = document.createElement('button');
  b.className = 'xlv-button';
  b.innerHTML = 'Extract cells';
  b.title = 'Extract cells'
  b.addEventListener('click', (evt) => {
    getMarkedCells(p.id);
  });
  p.buttonRow1.appendChild(b);	
}


function decryptStringWithXOR(input,key) {
  var c = '';
  var lastvalue = 0;
  
	var databuf = window.atob(input);   
  
   for(var i=0; i<databuf.length; i++) {
   		var k = i % key.length
      var value1 = databuf.charCodeAt(i);
      var value2 = key.charCodeAt(k);

      var xorValue = value1 ^ value2 ^ lastvalue
			lastvalue = value1;
			
      c += String.fromCharCode(xorValue);
  }
  return c;
}

const exolvedata = `
	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
	Az01CxMSC19+fHYpWzBuL3AtXDxMO3Jje2hlMgoAQxMjDxENeFhFdRQgJhhG
	UE8TJm94IRZ1cn9Le2ZFJFsFfE4kQUkrYiFYa0RJATsJUWFSYGdWSAhcVzdp
	MXMBLiA+DjZuVmQTHzlkaSVxT1RSQ3VfR0hoT0N7VGQtVVoQdkYeRhEAcngz
	KBwxZRQsFAh0bHx5MhBVFkZmQAsCMwMSIBUxeAANRyERSRFEVSclbmRYeCAe
	OU5LeiwrZzcVXF4baV5dUCUZBDQHJG1SDE93IRwQF0k7UA9OEUw9XStcFQNS
	V08eb2psKQ8pMCteeW5KZVYfLHV6e2IbRgw3bCZ8LVgsBzkVJ25dCQMKXXh0
	ey9daGZgQXxqXD0IBDJldH1kW11RDnwXSgtUCXgbah1UQhUaGkxqZnc1R2tm
	LjoAHD8bO3JDHxEUX2siLXlKbWN5DDAtXHVDTj5kYms8TQxbQxtRM2kNeSE9
	FS4uClNCV05zf30oHy42flh7alVzTUp9ZXV4IxcMHAFzR01Wd0pcags5PgtB
	RVBJOHkvN28lRx17D1dFa05CMm96dyAWGhVNbFtDCz0GEydGZWNUCR4aRmUs
	Z2UeVzVUM1EJeGpNS28kZ2I/BwEWVCYSEAwxCgciQ3FhVB9cGBVtDmRcPEcM
	RFAkKxI2BAF9ZXJ2KgJLWwsgTwQFI1dcYk58YVkIBQ4XMjMxdAYoIjNGcG0c
	KhIJNy9kPi51FX99H3w3CDQOVndabHwTCysmb00ECF9rCAUCJVFIOR4gJxIK
	DwpdZX90ZR9pK0kVSANgAXZLcy40eDIOAg1QIiwoMwMkeghxFEwrKGtzJQRN
	TBgpBQMCOQpSYgM2NhIKBwRFfXttL102aCl2K1o4Sj10YzInInVDCg1VdVNb
	R3tAVicSKmNeCQdLFiYhIXlFYSogFCQwGHkGXj4vRiMTcSxvfntdV004FQIm
	FWJpXBcATAI7NzorED0iLwguIwI3CQ45IRIfQmFtKDpQIXskSm01FyMEHShi
	IWVpFE8FPmUvdylcKAI8GW5mWARHYntYVEcXLB0TH2pfBz4KMDgGExwZS382
	J3lJZXoyTyx9Jm4wbQ0VVngoDRAWVScGGAQyDhMwUXJ6WAcBGVMiIi9wAmkz
	axdJOGAVcDlJITEkfkdHR1ZlREZCfl5fLg4tZFVNQkccPzcmbgNgREI3EQw7
	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
	DW42Rl5qbi5fWlwMKA5FWWNTSmIFcSBCSx9IAnNtYSIbeGdgFSA1FD0DCDFo
	ZXp8DUwaAloQci5IPGR3RHZ+WgoFDEZkLS1zT2hqdkpxZxY2FVxkPTN5YwpR
	AwVsXBcPPxkHOQowOAZdWxcGYSFIcCtcAko/OCkWPhoHMng7PnQFAxVQLk1W
	UXdQQXJfcTgfTlldRGZgbjocNzUzAXVsWXxOQzNibyMyVRV8RB9oNX0IGwx9
	SHA5Hk9ASFFweGksB2RmYBU1JRFwSkp+Ii0kPQMMTy0cMC8rHyU5SCFAAFpr
	AVlYKWBGDy0LEg57QF4vCyoqHkNOQR1sLXtjO3ETTyNXDxImCRU3ZmpzOUhH
	RRY2HBRDNi0jFyQQFitjZWctHQAKVWADCUF4RUlsQXMlVUUTVmU9XQsLeRo8
	Ox09ZUZiQ0N2OT8haxobGV5pChYfPg8FdF99c1BIA1pKEXEbH34dVm5ebXRW
	YkYPPGtlbCZXXF4MNVZKS2pWDi8cJD0IQgEFXWJvYDgEIGsrSzZEHFQ2ahoC
	JSxmQ1hUHCsaAkpsTUdkSmhvW0NMRRsvKC9/X2UuJRk5OEkgQwNZaG56LBEO
	CBQjDgFj
`;

let params = new URLSearchParams(document.location.search);
let query = params.get('key');

if(query) {
	let key = query instanceof Array ? query[0] : query;
	exdata = decryptStringWithXOR(exolvedata, key);
	
	if(exdata.match(/[^\s\x20-\x7E]/)) {
		// bad characters or key didn't match
	} else if(exdata.match(/exolve/)) {
		createExolve(exdata);		
	} 
}


</script>
</body>
</html>
