<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<!--
MIT License
Copyright (c) 2019 Viresh Ratnakar
See the full Exolve license notice in exolve-m.js.
-->
<link rel="stylesheet" type="text/css" href="exolve/exolve-m.css"/>
<script src="exolve/exolve-m.js"></script>

<title>Pirate_C by Darren Miller</title>

<style>
	body {
		font-family: "Gill Sans", sans-serif;
	}

	@media print {
		.extractButton {
		     visibility: hidden;
	   }
	}

	/* The Modal (background) */
	.modal {
	  display: none; /* Hidden by default */
	  position: fixed; /* Stay in place */
	  z-index: 5; /* Sit on top */
	  padding-top: 100px; /* Location of the box */
	  left: 0;
	  top: 0;
	  width: 100%; /* Full width */
	  height: 100%; /* Full height */
	  overflow: auto; /* Enable scroll if needed */
	  background-color: rgb(0,0,0); /* Fallback color */
	  background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
	}
	/* Modal Content */
	.modal-content {
	  position: relative;
	  background-color: #fefefe;
	  margin: auto;
	  padding: 0;
	  border: 1px solid #888;
	  width: 80%;
	  box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2),0 6px 20px 0 rgba(0,0,0,0.19);
	  -webkit-animation-name: animatetop;
	  -webkit-animation-duration: 0.4s;
	  animation-name: animatetop;
	  animation-duration: 0.4s
	}

	/* Add Animation */
	@-webkit-keyframes animatetop {
	  from {top:-300px; opacity:0} 
	  to {top:0; opacity:1}
	}

	@keyframes animatetop {
	  from {top:-300px; opacity:0}
	  to {top:0; opacity:1}
	}

	/* The Close Button */
	.modal-close {
	  color: white;
	  float: right;
	  font-size: 28px;
	  font-weight: bold;
	}

	.modal-close:hover,
	.modal-close:focus {
	  color: #000;
	  text-decoration: none;
	  cursor: pointer;
	}

	.modal-header {
	  padding: 2px 16px;
	  background-color: navy;
	  color: white;
	}

	.modal-body {
		padding: 16px;
		text-align: center;
		font-family: Consolas, monospace;
		font-size: larger;
		letter-spacing: -3px;
	}

	.modal-footer {
	  padding: 2px 16px;
	  background-color: #5cb85c;
	  color: white;
	}
</style>
</head>
<body>

<script src="exolve/dkm-exolve-utils.js"></script>
<div id="extractModal" class="modal">

  <!-- Modal content -->
  <div class="modal-content">
    <div class="modal-header">
      <span class="modal-close">&times;</span>
      <h3>Extraction</h3>
    </div>
    <div class="modal-body" onclick="selectall(this);">
    </div>
  </div>

</div>
<script>

let markedCells = [
	'o10', 'g13', 'f8', 'i9', 'a1', 'h14', 
	'j7', 'a3', 'n8', 'j8', 'k11', 'e14', 
	'l5', 'g6', 'j5', 'c5', 'o5', 'n14', 
	'g4', 'e3', 'i15', 'e12', 'm8', 'k12',
	'k10', 'e2', 'n6', 'j1', 'l13', 'f10',
	'f4', 'f12', 'h2', 'm12', 'c9', 'd13',
	'a11', 'a13', 'm3', 'i3', 'm7', 'd2',
	'f3', 'n3', 'd3', 'o7', 'n4', 'a4',
	'o1', 'g15', 'i11', 'b15', 'g9', 'j3',
	'c8', 'e7', 'h1', 'c7', 'j15', 'm15', 
	'e15', 'k13', 'e10'
];

function markupCells(p, cells, ht, basewid, labelcolor='') {
	for(let i=0; i<cells.length; i++) {
		let coords = p.parseCellLocation(cells[i]);   // [row,col]
		let wid = (i+1).toString().length*basewid-1;
		let c = p.addCellText(coords[0], coords[1], (i+1), ht, wid, false, true);
		c.style['stroke-width'] = 0.7;
		if(labelcolor) {
			c.style.stroke = labelcolor;	
		}
	}
	
	p.cellActivator(0,0); 
}

let extractModal;

function doCloseModal() {
	if(extractModal) { 
		if(extractModal.style.display == "none") { return; }
		extractModal.style.display = "none";
		window.getSelection().removeAllRanges();
	}
}

function getMarkedCells(pid) {

	let p = exolvePuzzles[pid];
	let result = '';
	for(let i=0; i<markedCells.length; i++) {
		if (result) { result += ' '; }
		let coords = p.parseCellLocation(markedCells[i]);   // [row,col]
		let gridCell = p.grid[coords[0]][coords[1]];
		if (gridCell.currLetter == '0' || gridCell.currLetter == '?') {
			result += "_";
		} else {
			result += gridCell.currLetter;
		}
	}
	// Get the modal
	if (!extractModal) {
		extractModal = document.getElementById("extractModal");
	
		if(extractModal) {
			var span = document.getElementsByClassName("modal-close");
			span[0].onclick = doCloseModal;
			window.onclick = function(e) {
				if(e.target == extractModal) { doCloseModal(); }
			}
			document.addEventListener('keydown', (event) => {
  			if (event.key === 'Escape') { doCloseModal(); }
  		});
		}
	}

	if(extractModal) {
		var modalBody = document.getElementsByClassName("modal-body");
		if(modalBody) {
			modalBody[0].innerHTML = result;
			extractModal.style.display = "block";
		}
	}
}

function selectall(elem) {
	if (window.getSelection) {
    var range = document.createRange();
    range.selectNode(elem);
    window.getSelection().removeAllRanges();
    window.getSelection().addRange(range);
  }
}

function customizeExolve(p) {
	markupCells(p, markedCells, 10, 6, 'darkblue');

  const b = document.createElement('button');
  b.className = 'xlv-button';
  b.innerHTML = 'Extract cells';
  b.title = 'Extract cells'
  b.addEventListener('click', (evt) => {
    getMarkedCells(p.id);
  });
  p.buttonRow1.appendChild(b);	
}


function decryptStringWithXOR(input,key) {
  var c = '';
  var lastvalue = 0;
  
	var databuf = window.atob(input);   
  
   for(var i=0; i<databuf.length; i++) {
   		var k = i % key.length
      var value1 = databuf.charCodeAt(i);
      var value2 = key.charCodeAt(k);

      var xorValue = value1 ^ value2 ^ lastvalue
			lastvalue = value1;
			
      c += String.fromCharCode(xorValue);
  }
  return c;
}

const exolvedata = `
	fBZCLyp0SjY3EjBCVTYKKyo2bmZoalEhSX9JKjcbWCs8MxcoQClsAHwWdS9y
	aWo/GBRaCT4aGB5BNW1ZYFhdeyZobTBbEhVPcB4FBCMWGi4cZj1dVwZgeQgE
	H0F/SkQBIB0RLAhlLCxxYHwpHQwGWWwPNDUSJysfLXA5SRQPDFl+cjx+SX5h
	bEslfWhIbXZDFVZ3JxofGVoCYSonCjElAiZcVmkhOyV1Q0JVXixdBlw7T3ND
	cFVZZ39RVAE8MCEaaAsFFS8XGS1BYWFVGRJEXT1hCBlrTV5ZYEJfIwo4OA9f
	SB4HZztSQzEXBAM6GAV5SG1hUAUEBFgzUDoCByFqY0V6Z1IzFxEscTIufl1V
	QhY3VF4WMhMOLBknIR8LSEYKL2ZxKB81LGRQamFHY0ZcLGNleydWTU8KMBYP
	R3FXVndCfHYIED4zc0BMD0d6TAcMOAJaY0d8ZQoSex4uQ19QXzEeHEpQanFF
	JAoMKTEhIndQXB9aYEYNFTUbGSQAezIWRkAMCTlwezgPKnwzRTZuUH9LTncs
	JHVrSERTFzcaUV5uTntLeERIfAcBAVR2N3YjGjRyalZwaUxoTAhqYjNtdg5A
	HUJlS0JPaFlFNAYgPA1HQV5bJS1wYURuaW0YKzodOU5GNmhiYDgFTF0FMxQT
	HmUNWmdPJkUcLXJyIk19cTVHZ21rHjk0BysVCHg5NSxnFhkTTH9QGxIpDgE1
	BnF3VU1JQA18fXcoDj51fF0pWwNLIChYCBkQTyNtZiMFNi58Bn1hUWJHS3U+
	LTR3XFlfHWFAR0ByVV1jVi8lGk8DSFEKagBFfklOQytYZ1k4Gx1tERMNRnJ1
	MGBCbnYlA3dfe0BtaF0WVVsOMD56a01vdnlJaSxaRHF0RRMbUFdCSlsYLwJP
	RmNYUzkLfEVgIjs7Z0UMDVBtSR5ZbQdRPFJpaQc1Xzo/QV1SXQVmLSANNiIF
	IVtdfTE7OG8ETU0TLQEYXWleUmpdbzwAUVVRHDQ4N2pXYwJKPw4OMB08ME0a
	CRFBf3ghMAEtKi0Kc2JdbE5TOXN/ajIPBAtPeBsTFC0WHGBAZX5BDldXBzEw
	J29Yd3B3VQtTIgYpLxNdWxpMbXB6JBhhKiEbIzQXe0BAdycwcSQUHxlEOxEU
	DCwMTmhBf2JXZSZqNh8ZFlFmCAwUNQgfIFssJhlNQV9LdnZyKw1jfHFcfCkR
	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
	dSt2FQ1ObzcNAUISLQsOAiRQSWwNPzcVQVsXT3hlYyAcMDQyRzt2DkUbex8T
	UBxqS0dKW35UW1YjAxRlQXdqGk5ETFV3cX8rET0haRR2J3w0ajdQSAslblZa
	X05vXFZNdQEYPVx5dUkQCw5ZbyYpd0Zke3pAenEAaQpKECFLEhtqIxVKcUZI
	RDEGHz4WNT0BSgkKVSQiLXgKBwkWY3JkUn9JTnpiKXZmPV03M1Mwe0pwUQk/
	GzhxSB4JChMxKCRhEyclOQRwaRgqCRInfnA8LUkJYFgDdSpiFwAKPh49PRtG
	BRtHZn17OQ4jPDUUKT4BM0RCdGx/cjkcHBpYKgUPBDoHESdGYWFUTAdfTxR0
	Hhp+HVZtSHNgVDUQECd3YCx3Q0xAAzRXXVtpT04/LRsHM2IhZWoScRsjRDB7
	MyMaATURZntEXEtPBDokZzdFdnxmR2oySz5AI3pLHUlQIRsZRWdIRg40Bl5u
	QWJiVB4YEVJmLy1oGjcze01xaEttXxZuYihOfiZ6IDFDTEJLeg4ZOltkbE4S
	UU8ZKylmd0hqeHJCNmYCajdXDgBTHwYDBQsWZE5XUGsfCCwZbnNLFlVKEDM/
	OWYUfyNiPWARdgZxOCt8cnM/AAAAUHZcWF4rFh1sSXdtUhgcEUZ+bWs+TG5r
	ZxInMw8hBRhoPykxKBYZWg88CwVNMFMCWRFPEHJqKQwVKCQhZBYzMTgDNClY
	cElDfCk6OmZDTwITFj0veA0QHGsJZj1cUwsUDT85N3ZIYmpjQnNvHncVVQ8+
	VA4EdTwMVWhcUkg9BhhpTHJoXxICGkp1ezh7SH80LBwkKAprFEU8DmRtLBIX
	AlYpDgoVLkAyaiJHDn4SEBFYbHd9Ihd0aGlIdCw4GD04TlUOUFg+bHxtWnd5
	Y1F8KFlKfGwDG1AJGUIiSEo4W2B6Sm1mQnFDWSlidXwyAhkeSmtbVU47Gwx9
	WWRoWxdUbzcCDk1UPlQ1VAhoMEFQZn1ZGFtfCSs2JjcDITk5BT4oGDsADHwh
	LitmUhtQVyxlB2YGciooADojH14dGE95dXggHSszZBELHDlYfmJbFxFRSHh/
	eGlVeWYuDykkEHEOUisZcxYZaCEDEjcGCA59CkopWTlrSFBeVx0/dnIsGytg
	YFB2axpzElIIOVMIEWBeVAs+ER8EIlZZYEB7d1RMTlAMfWVzKw0rYGBQZXFU
	fVMaYm4kQnIqezgpPgsFA3ZVRXFeKTMGUEcLUGBqYn8NB0oBbApDJV9sJRtG
	U1oRYH17OR98dj4DODIQNEMCZ3YfekoiayhKaERARnZQCCoKNDlFXRgYRWV5
	dX9+WFYSZ2FxRXBTBXUdCxMKPiEnZE94e3pBcioZOQ0PfzM/cyQaAQ9fYQNO
	VGVATXMJfj9aSyJHdxdODRwcMDI2CjAvXnhdVXxkdH0lVEROGiQDAQc1QVgp
	GyAgE0ADR0gwUzkBYhNYEAY9Kw4qEAk1bHt+KBcNTh4uAhwAdUhXaEZjY10C
	QU4bIyclYFcrYEFgFAI2ATMoWAUIAEo7eio2UDpbOmYDTz5fREJ9NjBwaVVZ
	SQsgQ0pXbBgJNldja0saDQBVJCInNiAGAwYyFAd2H34+ZFU/Ym4fVmY7ADN4
	cVNmZxYgHxMtNTcofUlFVkd0QwgTIxZON0A+XQQ1ZzMqW2FrNggyeV5nWlRs
	TDshAVxRSVAleTpkWDsjKgo9IFE4WhpAcRtFTj92RhopGAcKLVlSbFh7ek8F
	CEQbJSMsPQAtZmJSZ3sHIAUJPCQ3Mm5NBE9JMnsZeB9/J1ZabGlcREZEGWhv
	YyZUenB8BXFrT3oNFyt2e3MvDEUOC3A5WzpdPGQVBzUoCxMWE1hsJTJsHjh+
	ZFRhfUl6XhdvYCpMfCR/KzpIRkJZeAwVMxQ2M0M8OiRwQEcERnVDW1JgUQV0
	R3VsUxkOB1pndzQtSiBBIHwaWypLWlx+JSNvJRwaDRwhFwhAekgQKAQjbB8f
	ThMdd20ud0p9c3cCfjNLAF4+XVQXWyoeBQQVLw0VXWkdCzMRI2pZCQsJV2Mq
	JnEDMy0sDXkpTSV4GEFKHFBJX1kaSXpaWhIzCFBkXX5lUAUDTyMIAwVfZFRL
	QnkNBTUGJTVFVQJHdCxMHBtpCjM+CiwmFjkJBXUsb3EpH1oZRXZbEVkkRxZN
	BVsBZn49Fl15dnMnBjF6e0ByZUZqXFt/Z2xhKhkfDkw+DhUUJANbIlslRh8u
	fiozQnl/KA8/MXlEf3MCMwsWZicrIGxPUg4fGTI4JFcgYANzE0Fiend0OUhO
	SRxvDE8UbQpbAEgWTCU9fkEMKCU/Lg8kIDobb2NTfkxWJn9+fTEUXUoeKR4d
	VShKG0AIVgtqcjEKW3M6NWFSZ2khADsnFy9eFHx2JH99XxYCXHxUHwM5TVRo
	WWZmVAUHBU8haCMnXBV3FncQSDk6HxMibmVlORsBQgE2FBwAPAcRYEBjKhJL
	RQ8VfCd1cxoqYXlJb3FPfEZOcCstYXAXVz4GXSp0PElOX2BIbHFEDk1IAnN1
	YyZYOyAnASY3BCkHTmk4LysyEBYYTGpBQ0V3AxovCjg1RRQZVUQjYwoyaR5D
	C35tegs+Bk9oOTY+JwYOH1pxEhAWY0NTZwY8PAhUW1JLdXo5W2pGWV1pU08+
	VzZ2LB13Ly5fFjB5W31keA02KFl9XFxoNTg3axpbDRVNB2U5VSF5ZFB/Y0EQ
	HAVPPjEzYEBqYjVAW1VhUmZgXRUTEVtrdnwjFnV/Nw4zPxo3BVMjM2UgE0sr
	fX0PbEpNa0sTMBQ1NQBPSVcdbG1vKB98YGlIeXMCKQsFJj51LDxnB21pCGsg
	GCgbAiAUMHlKHRMaUCEqKHpDIDw9HCB4WWpSS340d3MrFBkWTnJWHV09QDJq
	IkAcbHRQVQBxeXgoFDM3MQExaUx/QUR7JD5yLRMISxYhBQsNPAkDK0p+flob
	WBwRaQpgNB4yNSsbYn9AZThbNjNtPDhUb0koNjQcMURHdnN6DT0iT34yW19s
	VSg/XHZcRkR5FWkDVzo/
`;

let params = new URLSearchParams(document.location.search);
let query = params.get('key');

if(query) {
	let key = query instanceof Array ? query[0] : query;
	exdata = decryptStringWithXOR(exolvedata, key);
	
	if(exdata.match(/[^\s\x20-\x7E]/)) {
		// bad characters or key didn't match
	} else if(exdata.match(/exolve/)) {
		createExolve(exdata);		
	} 
}


</script>
</body>
</html>
