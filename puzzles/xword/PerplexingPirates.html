<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<!--
MIT License
Copyright (c) 2019 Viresh Ratnakar
See the full Exolve license notice in exolve-m.js.
-->
<link rel="stylesheet" type="text/css" href="exolve/exolve-m.css"/>
<script src="exolve/exolve-m.js"></script>

<title>Perplexing Pirates by Darren Miller</title>

<style>
	body {
		font-family: "Gill Sans", sans-serif;
	}

	@media print {
		.extractButton {
		     visibility: hidden;
	   }
	}

	/* The Modal (background) */
	.modal {
	  display: none; /* Hidden by default */
	  position: fixed; /* Stay in place */
	  z-index: 5; /* Sit on top */
	  padding-top: 100px; /* Location of the box */
	  left: 0;
	  top: 0;
	  width: 100%; /* Full width */
	  height: 100%; /* Full height */
	  overflow: auto; /* Enable scroll if needed */
	  background-color: rgb(0,0,0); /* Fallback color */
	  background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
	}
	/* Modal Content */
	.modal-content {
	  position: relative;
	  background-color: #fefefe;
	  margin: auto;
	  padding: 0;
	  border: 1px solid #888;
	  width: 80%;
	  box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2),0 6px 20px 0 rgba(0,0,0,0.19);
	  -webkit-animation-name: animatetop;
	  -webkit-animation-duration: 0.4s;
	  animation-name: animatetop;
	  animation-duration: 0.4s
	}

	/* Add Animation */
	@-webkit-keyframes animatetop {
	  from {top:-300px; opacity:0} 
	  to {top:0; opacity:1}
	}

	@keyframes animatetop {
	  from {top:-300px; opacity:0}
	  to {top:0; opacity:1}
	}

	/* The Close Button */
	.modal-close {
	  color: white;
	  float: right;
	  font-size: 28px;
	  font-weight: bold;
	}

	.modal-close:hover,
	.modal-close:focus {
	  color: #000;
	  text-decoration: none;
	  cursor: pointer;
	}

	.modal-header {
	  padding: 2px 16px;
	  background-color: navy;
	  color: white;
	}

	.modal-body {
		padding: 16px;
		text-align: center;
		font-family: Consolas, monospace;
		font-size: larger;
		letter-spacing: -3px;
	}

	.modal-footer {
	  padding: 2px 16px;
	  background-color: #5cb85c;
	  color: white;
	}
</style>
</head>
<body>

<script src="exolve/dkm-exolve-utils.js"></script>
<div id="extractModal" class="modal">

  <!-- Modal content -->
  <div class="modal-content">
    <div class="modal-header">
      <span class="modal-close">&times;</span>
      <h3>Extraction</h3>
    </div>
    <div class="modal-body" onclick="selectall(this);">
    </div>
  </div>

</div>
<script>

let markedCells = [
	'o10', 'g13', 'f8', 'i9', 'a1', 'h14', 
	'j7', 'a3', 'n8', 'j8', 'k11', 'e14', 
	'l5', 'g6', 'j5', 'c5', 'o5', 'n14', 
	'g4', 'e3', 'i15', 'e12', 'm8', 'k12',
	'k10', 'e2', 'n6', 'j1', 'l13', 'f10',
	'f4', 'f12', 'h2', 'm12', 'c9', 'd13',
	'a11', 'a13', 'm3', 'i3', 'm7', 'd2',
	'f3', 'n3', 'd3', 'o7', 'n4', 'a4',
	'o1', 'g15', 'i11', 'b15', 'g9', 'j3',
	'c8', 'e7', 'h1', 'c7', 'j15', 'm15', 
	'e15', 'k13', 'e10'
];

function markupCells(p, cells, ht, basewid, labelcolor='') {
	for(let i=0; i<cells.length; i++) {
		let coords = p.parseCellLocation(cells[i]);   // [row,col]
		let wid = (i+1).toString().length*basewid-1;
		let c = p.addCellText(coords[0], coords[1], (i+1), ht, wid, false, true);
		c.style['stroke-width'] = 0.7;
		if(labelcolor) {
			c.style.stroke = labelcolor;	
		}
	}
	
	p.cellActivator(0,0); 
}

let extractModal;

function doCloseModal() {
	if(extractModal) { 
		if(extractModal.style.display == "none") { return; }
		extractModal.style.display = "none";
		window.getSelection().removeAllRanges();
	}
}

function getMarkedCells(pid) {

	let p = exolvePuzzles[pid];
	let result = '';
	for(let i=0; i<markedCells.length; i++) {
		if (result) { result += ' '; }
		let coords = p.parseCellLocation(markedCells[i]);   // [row,col]
		let gridCell = p.grid[coords[0]][coords[1]];
		if (gridCell.currLetter == '0' || gridCell.currLetter == '?') {
			result += "_";
		} else {
			result += gridCell.currLetter;
		}
	}
	// Get the modal
	if (!extractModal) {
		extractModal = document.getElementById("extractModal");
	
		if(extractModal) {
			var span = document.getElementsByClassName("modal-close");
			span[0].onclick = doCloseModal;
			window.onclick = function(e) {
				if(e.target == extractModal) { doCloseModal(); }
			}
			document.addEventListener('keydown', (event) => {
  			if (event.key === 'Escape') { doCloseModal(); }
  		});
		}
	}

	if(extractModal) {
		var modalBody = document.getElementsByClassName("modal-body");
		if(modalBody) {
			modalBody[0].innerHTML = result;
			extractModal.style.display = "block";
		}
	}
}

function selectall(elem) {
	if (window.getSelection) {
    var range = document.createRange();
    range.selectNode(elem);
    window.getSelection().removeAllRanges();
    window.getSelection().addRange(range);
  }
}

function customizeExolve(p) {
	markupCells(p, markedCells, 10, 6, 'darkblue');

  const b = document.createElement('button');
  b.className = 'xlv-button';
  b.innerHTML = 'Extract cells';
  b.title = 'Extract cells'
  b.addEventListener('click', (evt) => {
    getMarkedCells(p.id);
  });
  p.buttonRow1.appendChild(b);	
}

function decryptStringWithXOR(input,key) {
  
  const utf8Encode = new TextEncoder();
	var c = utf8Encode.encode(window.atob(input));
	var kb = utf8Encode.encode(key);
	
 	for(var i=0; i<c.length; i++) {
		for(var r=0; r<kb.length; r++) {
			var k = r % kb.length;
		  c[i] = c[i] ^ kb[k];
	 	}
	}
  
	return (new TextDecoder()).decode(c);
}

const exolvedata = `
	TExMTExMIzQhPTAyNFEmOCU5USg+JCNRISQrKz00UTM0PT4mTExMTExMe3sUCR4dBxRcEx
	QWGB97UVEUCR4dBxRcGBVLURUaHFwBGAMQBRQCXENBQ0N7UVEUCR4dBxRcBRgFHRRLUSEU
	AwEdFAkYHxZRIRgDEAUUAntRURQJHh0HFFwCFAUFFANLUTUQAwMUH1E8GB0dFAN7UVEUCR
	4dBxRcEh4BCAMYFhkFS1FDQUNDUTUQAwMUH1E8GB0dFAN7UVEUCR4dBxRcEgMUFRgFAktR
	JRQCBRQDAktRNgMUFlE1XVEwHwUZHh8IUTl7UVEUCR4dBxRcBhgVBRlLUUBEe1FRFAkeHQ
	cUXBkUGBYZBUtRQER7UVEUCR4dBxRcAQMUEBwTHRRLe3h4JhRREAIaFBVRAh4cFFEBGAMQ
	BRQCURBRAAQUAgUYHh9dURMEBVEFGRQYA1EQHwIGFAMCUQYUAxRRAxAFGRQDURIDCAEFGB
	JfUTwQCBMUUQgeBFESEB9RGRQdAU5Re3h4TQQdT00dGE8+HxIUUQgeBFECHh0HFFEFGRRR
	AQQLCx0UXVEFGRRRTRBRGQMUF0xWUlZRHh8SHRgSGkxWAxQFBAMfURYUBTwQAxoUFTIUHR
	0CWVMVGhxcARgDEAUUAlxDQUNDU1hWTx8EHBMUAxQVUQIABBADFAJNXhBPUQYYHR1RFhgH
	FFEQURcYHxAdUQMYFRUdFF9NXh0YT3t4eE0dGE8oHgRREhAfUQIEExwYBVEIHgQDURcYHx
	AdURAfAgYUA1EeA1EWFAVRGRgfBQJREAVRe3h4TRBRGQMUF0xWGQUFAQJLXl4VEAMDFB8C
	AQQLCx0UAl8THR4WAgEeBV8SHhxeQ0FDQ15BSF4BFAMBHRQJGB8WXAEYAxAFFAJfGQUcHV
	ZRe3h4BRgFHRRMVjYeUQUeUTUQAwMUH1cQAR4CSgJRIQQLCx0UAlETHR4WVlEFEAMWFAVM
	Vi4THRAfGlZPNRADAxQfVxABHgJKAlEhBAsLHRQCURMdHhZNXhBPX01eHRhPe3h4TV4EHU
	97UVEUCR4dBxRcHgEFGB4fS1ESHh0eA1wQEgUYBxRLHRgWGQUIFB0dHgZ7UVEUCR4dBxRc
	HgEFGB4fS1ESHh0eA1wYHwEEBUsDHggQHRMdBBRREh4dHgNcEAMDHgZLHRgWGQUIFB0dHg
	Z7UVEUCR4dBxRcHgEFGB4fS1ESHh0eA1wdGBYZBVwdEBMUHVwYHwEEBUsGGRgFFHtRURQJ
	Hh0HFFweAQUYHh9LURIeHR4DXB0YFhkFXAUUCQVcGB8BBAVLBhkYBRR7UVEUCR4dBxRcHg
	EFGB4fS1ESHh0eA1wTBAUFHh9LHxAHCFESHh0eA1wTBAUFHh9cGR4HFANLAQQDAR0Ue1FR
	FAkeHQcUXB4BBRgeH0tREh0EFAJcARAfFB1cHRgfFAJLQ0F7UVEUCR4dBxRcHgEFGB4fS1
	EZGBUUXBIeAQhcAR0QEhQZHh0VFANcEwQFBR4fAntRURQJHh0HFFwDFB0QExQdS3tRUVFR
	Eh0UEANLUTIdFBADUQUZGAJRBh4DFXtRUVFRAxQHFBAdS1EiGR4GURkYHwVRFx4DURwUBR
	keFVkCWHtRURQJHh0HFFwWAxgVS3t4eEEuQVFBLkFRQS5BUUEuQQ1BDUFRQS5BUUEuQQ1B
	UXt4eEEuQVFBLkFRQS5BUUENQQ1BUUFRQS5BUUEuQVFBUXt4eEFRQVFBUUFRQVpBDUENQV
	FBUUFRQVpBUUFRQVFBUXt4eEENQVFBUUFRQS5BUUENQQ1BUUEuQS5BDUENQQ1BUXt4eEFR
	QS5BUUFRQQ1BDUENQS5BUUENQQ1BLkFRQS5BUXt4eEENQQ1BDUENQVFBLkFRQVFBLkENQV
	FBLkFRQVFBLnt4eEFRQVFBUUFRQQ1BLkFRQVFBLkFRQVFBLkEuQVFBLnt4eEEuQVFBLkEu
	QVFBUUFaQQ1BUUEuQVFBUUFRQVFBUXt4eEEuQVFBUUEuQVFBUUEuQVFBUUFaQVFBUUFRQV
	FBUXt4eEFRQS5BUUEuQQ1BUUFRQS5BUUFRQQ1BDUENQVpBUXt4eEFRQVFBUUENQVpBLkFR
	QQ1BDUENQS5BUUFRQVFBUXt4eEENQQ1BDUFRQS5BUUENQQ1BUUFRQS5BUUFRQQ1BUXt4eE
	FRQVFBLkENQS5BUUFRQQ1BDUENQS5BUUEuQVFBLnt4eEFRQVFBLkFRQS5BUUENQQ1BLkFR
	QS5BUUEuQVFBLnt4eEENQVFBUUFRQVFBDUENQVFBUUFRQVFBUUFRQVFBUVFRUVFRUVFRUV
	FRUVFRUVFRUVFRUVFRUVFRUVFRe3gUCR4dBxRcEBIDHgICS3t4eEBRUT4VFV1REwQdHRgU
	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
	TExMTHs=
`;

let params = new URLSearchParams(document.location.search);
let query = params.get('key');

if(query) {
	let key = query instanceof Array ? query[0] : query;
	exdata = decryptStringWithXOR(exolvedata, key);
	
	if(exdata.match(/[^\s\x20-\x7E]/)) {
		// bad characters or key didn't match
	} else if(exdata.match(/exolve/)) {
		createExolve(exdata);		
	} 
}


</script>
</body>
</html>
